create view book_info as select bo.book_id, bo.title, coalesce((select count(*) from reviews r where r.book_id = bo.book_id), 0) as revcnt,coalesce((select avg(rating) from reviews r where r.book_id = bo.book_id), 0) as rating,coalesce((select avg(rating) from reviews r where r.book_id = bo.book_id and strftime('%Y', rdate) = '2023'), 0) as rating23,coalesce((select count(*) from (select book_id from borrowings where book_id = bo.book_id union all select book_id from waitlists where book_id = bo.book_id)), 0) as reqcnt from books bo; select * from book_info;
