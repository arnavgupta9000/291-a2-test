CREATE VIEW test AS SELECT bo.book_id, bo.title, COALESCE((SELECT COUNT(*) FROM reviews r WHERE r.book_id = bo.book_id), 0) AS revcnt,COALESCE((SELECT AVG(rating) FROM reviews r WHERE r.book_id = bo.book_id), 0) AS rating,COALESCE((SELECT AVG(rating) FROM reviews r WHERE r.book_id = bo.book_id AND strftime('%Y', rdate) = '2023'), 0) AS rating23,COALESCE((SELECT COUNT(*) FROM (SELECT book_id FROM borrowings WHERE book_id = bo.book_id UNION ALL SELECT book_id FROM waitlists WHERE book_id = bo.book_id)), 0) AS reqcnt FROM books bo;
